<!DOCTYPE html>
<html>
 <!-- Per insertar Codi, podeu utilitzar http://hilite.me/ -->
    <head>
        <title>Data Viz. Big Data UAB</title>
        <link href="styles/style.css" rel="stylesheet" type="text/css">
        <!-- Si voleu canviar la font o algun altre paràmetre, ho podeu fer aquí, o al CSS -->
        <style>
            body {
                background-color: white;
            }
            .container {
                max-width: 1100px;
            }
            h1, h2, h3, h4, h5, p {
                color:black;
            }
            a:link {
                color:brown;
            }
            a:visited {
                color: #555a5e;
            }
            center img{
                margin: 0 auto;
                max-width: 50%;
            }
        </style>
    </head>
    <body>
        <div class="container">
            <header>
            <p>Autors: Miquel Coll, Alexander Morales</p>
            </header>
                <h1>Introducció</h1>
                <p>Aquest estudi es planteja amb la següent hipòtesi: a partir de la música es poden definir característiques de les diferents cultures del món.</p>
                <h1>Codi</h1>
                <p>El procés d'obtenció de dades sha realitzat mitjançant l'accés a l'api de desenvolupador de Spotify a través d'un codi de python. El primer pas realitzat per aquesta recolecció de dades es crear una aplicació d'Spotify Dev per poder accedir a l'api. Aquesta aplicació genera un Client ID i un Client Secret, dos claus que introduirem al python y mitjançant diferents mòduls utilitzarem per extreure informació de l'api d'Spotify.</p>
		<img src="Spotify Dev.JPG"  width="460" height="345">
		<h2>Mòduls</h2>
		<p>Un cop tenim aquestes credencials ja podem començar amb el arxiu de python. Comencem instalant i important els mòduls que necessitarem per l'extracció.</p>
		<!-- HTML generated using hilite.me --><div style="background: #272822; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #f92672">import</span> <span style="color: #f8f8f2">spotipy</span>
<span style="color: #f92672">import</span> <span style="color: #f8f8f2">json</span>
<span style="color: #f92672">from</span> <span style="color: #f8f8f2">spotipy.oauth2</span> <span style="color: #f92672">import</span> <span style="color: #f8f8f2">SpotifyClientCredentials</span>
<span style="color: #f92672">import</span> <span style="color: #f8f8f2">time</span>
<span style="color: #f92672">import</span> <span style="color: #f8f8f2">pandas</span> <span style="color: #f92672">as</span> <span style="color: #f8f8f2">pd</span>
</pre></div>
		<p>El primer de tots es la biblioteca de "spotipy", biblioteca de lliure accés creada per Paul Lamere pensada per manipular la api d'Spotify. També farem servir la biblioteca de "json", bàsicament per tenir accés i visualitzar arxius json, que serà el tipo d'arxiu que extraurem de la api. El tercer as preparatori es importar l'intèrpret de les credencials d'Spotify desde el propi mòdul d'Spotipy.
Importem també el mòdul "time" per afegir un temps de pausa a les peticions, en motiu d'evitar el bloqueig per sobresaturació de la api. I per acabar importem el mòdul "pandas" que emprarem per traballar amb datasets i dataframes.</p>
		<h2>Preparació</h2>
		<p>Comencem assignant les dues credencials a dues variables internes. I amb aquestes dues variables i l'ajuda del "SpotifyClientCredentials" aconseguim el "auth_manager".  I mitjançant aquest objecte auth_manager per l'autentificació aconseguim accés a Spotify amb el modul d'Spotipy assignant aquest modul com a "sp".
</p>
		<!-- HTML generated using hilite.me --><div style="background: #272822; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #f8f8f2">SPOTIPY_CLIENT_ID</span> <span style="color: #f92672">=</span> <span style="color: #e6db74">&#39;89f634cbfb22458fbd2b396dd25496ee&#39;</span>
<span style="color: #f8f8f2">SPOTIPY_CLIENT_SECRET</span> <span style="color: #f92672">=</span> <span style="color: #e6db74">&#39;f266a68c3f5f4fc6901091f6f7fb553e&#39;</span>

<span style="color: #f8f8f2">auth_manager</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">SpotifyClientCredentials(SPOTIPY_CLIENT_ID,</span> <span style="color: #f8f8f2">SPOTIPY_CLIENT_SECRET)</span>
<span style="color: #f8f8f2">sp</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">spotipy</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">Spotify(auth_manager</span><span style="color: #f92672">=</span><span style="color: #f8f8f2">auth_manager)</span>

<span style="color: #f8f8f2">playlist_ids</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">[</span><span style="color: #e6db74">&quot;37i9dQZEVXbO839WGRmpu1&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;37i9dQZEVXbKPTKrnFPD0G&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;37i9dQZEVXbK4fwx2r07XW&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;37i9dQZEVXbKzoK95AbRy9&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;37i9dQZEVXbMda2apknTqH&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;37i9dQZEVXbLJ0paT1JkgZ&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;37i9dQZEVXbL1Fl8vdBUba&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;37i9dQZEVXbJZGli0rRP3r&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;37i9dQZEVXbIZQf3WEYSut&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;37i9dQZEVXbJPVQvqZqpcM&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;37i9dQZEVXbMy2EcFg5F9m&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;37i9dQZEVXbLp5XoPON0wI&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;37i9dQZEVXbJVKdmjH0pON&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;37i9dQZEVXbJHSzlHx2ZJU&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;37i9dQZEVXbMdvweCgpBAe&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;37i9dQZEVXbMWDif5SCBJq&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;37i9dQZEVXbIZK8aUquyx8&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;37i9dQZEVXbJ5J1TrbkAF9&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;37i9dQZEVXbKqiTGXuCOsB&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;37i9dQZEVXbLeBcWrdps2V&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;37i9dQZEVXbMPoK06pe7d6&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;37i9dQZEVXbKcS4rq3mEhp&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;37i9dQZEVXbNM8vS9cIqAG&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;37i9dQZEVXbKUoIkUXteF6&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;37i9dQZEVXbLw80jjcctV1&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;37i9dQZEVXbIWlLQoMVEFp&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;37i9dQZEVXbNy9tB5elXf1&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;37i9dQZEVXbNSiWnkYnziz&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;37i9dQZEVXbMGcjiWgg253&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;37i9dQZEVXbN66FupT0MuX&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;37i9dQZEVXbJV3H3OfCN1z&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;37i9dQZEVXbJ7qiJCES5cj&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;37i9dQZEVXbMVY2FDHm6NN&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;37i9dQZEVXbNvXzC8A6ysJ&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;37i9dQZEVXbKZyn1mKjmIl&quot;</span><span style="color: #f8f8f2">]</span>
<span style="color: #f8f8f2">paises</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">[</span><span style="color: #e6db74">&quot;SAU&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;ARG&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;AUS&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;BRA&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;CAN&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;CHI&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;COL&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;KOR&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;EAU&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;ECU&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;EGY&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;USA&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;PHI&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;GUA&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;HKG&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;IND&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;IDN&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;ISR&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;JAP&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;KAZ&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;DOM&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;MAL&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;MAR&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;MEX&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;NIG&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;NZE&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;PAK&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;PAN&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;PER&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;SGP&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;SAF&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;THA&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;TWN&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;VEN&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;VNM&quot;</span><span style="color: #f8f8f2">]</span>
</pre></div>
		<p>Un cop tenim accés a l'Api procedim a manualment agafar els id de les playlist que ens interessen. En aquest cas totes les playlists del TOP 50 cançons de cada païs. En aquest codi d'exemple hi ha 35 països fora d'Europa, ja que els països europeus s'han extret amb un codi idèntic però generant un dataset només europeu. Al mateix temps que recolectem les id de les playlist en un altre llista i en el mateix ordre afegim el codi de tres lletres per a cada païs. Hem decidit fer servir aquest codi ja que d'aquesta manera Tableau reconeix els països i pots fer infografies de mapas.</p>
		<h2>Iteració i recolecció</h2>
		<p>Gràcies a la documentació d'spotipy així com a l'analisi d'un json de prova vam poder arribar a veure com accedir a les dades que ens interessaven així com quina era la nomenclatura adequada per accedir-hi. Un cop fet aquests passos previs es moment d'aconseguir les dades definitives. 
		<!-- HTML generated using hilite.me --><div style="background: #272822; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #66d9ef">for</span> <span style="color: #f8f8f2">list,</span> <span style="color: #f8f8f2">pais</span> <span style="color: #f92672">in</span> <span style="color: #f8f8f2">zip(playlist_ids,</span> <span style="color: #f8f8f2">paises):</span>
    <span style="color: #f8f8f2">query</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">sp</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">playlist_items(list,</span> <span style="color: #f8f8f2">fields</span><span style="color: #f92672">=</span><span style="color: #f8f8f2">None,</span> <span style="color: #f8f8f2">limit</span><span style="color: #f92672">=</span><span style="color: #ae81ff">100</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">offset</span><span style="color: #f92672">=</span><span style="color: #ae81ff">0</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">market</span><span style="color: #f92672">=</span><span style="color: #f8f8f2">None)</span>

    <span style="color: #66d9ef">with</span> <span style="color: #f8f8f2">open(f</span><span style="color: #e6db74">&quot;{pais}-{list}.json&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&#39;w&#39;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">encoding</span><span style="color: #f92672">=</span><span style="color: #e6db74">&#39;utf-8&#39;</span><span style="color: #f8f8f2">)</span> <span style="color: #66d9ef">as</span> <span style="color: #f8f8f2">f:</span>
        <span style="color: #f8f8f2">json</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">dump(query,</span> <span style="color: #f8f8f2">f,</span> <span style="color: #f8f8f2">ensure_ascii</span><span style="color: #f92672">=</span><span style="color: #f8f8f2">False,</span> <span style="color: #f8f8f2">indent</span><span style="color: #f92672">=</span><span style="color: #ae81ff">4</span><span style="color: #f8f8f2">)</span>
</pre></div>
		<p>I a la variable query li assignem tots els items de la playlist fent servir la playlist ID de cada païs. Per tant per a cada iteració "query" conté tots els items de cada un dels països. Per tant ens interessa generar un json per a cada païs. Per tant creem un json de nom el païs més la playlist ID. I en aques json aboquem tota la query pertanyent a aquell païs.
		<!-- HTML generated using hilite.me --><div style="background: #272822; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #66d9ef">for</span> <span style="color: #f8f8f2">i</span> <span style="color: #f92672">in</span> <span style="color: #f8f8f2">query[</span><span style="color: #e6db74">&#39;items&#39;</span><span style="color: #f8f8f2">]:</span>
        <span style="color: #f8f8f2">song_id</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">i[</span><span style="color: #e6db74">&quot;track&quot;</span><span style="color: #f8f8f2">][</span><span style="color: #e6db74">&quot;id&quot;</span><span style="color: #f8f8f2">]</span>
        <span style="color: #f8f8f2">track_name</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">i[</span><span style="color: #e6db74">&quot;track&quot;</span><span style="color: #f8f8f2">][</span><span style="color: #e6db74">&quot;name&quot;</span><span style="color: #f8f8f2">]</span>
        <span style="color: #f8f8f2">features</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">sp</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">audio_features(song_id)</span>
        <span style="color: #f8f8f2">artists_name</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">i[</span><span style="color: #e6db74">&quot;track&quot;</span><span style="color: #f8f8f2">][</span><span style="color: #e6db74">&quot;album&quot;</span><span style="color: #f8f8f2">][</span><span style="color: #e6db74">&quot;artists&quot;</span><span style="color: #f8f8f2">]</span>
        <span style="color: #f8f8f2">cantants</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">[]</span>
</pre></div>
		<p>En aquesta primera iteració obtenim uns paràmetres claus. Aconseguim el "ID" de la cançó, el nom de la cançó, el nom de l'artista d'aquesta canço i introduim en una llista tots els "audio_features". Finalment creem una llista buida per als cantants, ja que a la variable d'artists_name i ha més d'un artista en molts casos, i només ens interessa assignar un artista a cada cançó.</p>
Ja hem establert que la query conté els elements d'una playlist. Així que és moment d'extreure aquells elements d'items que ens interessin. Primer creem una llista per volcar les mesures de cada cançó i iterem sobre "items" de "query". Que bàsicament es iterar sobre cada cançó de la playlist, per tant "i" és cada cançó.</p>
Comencem iterant sobre les llistes d'identificadors de playlists i països simultaneament. Aconseguim una llista on cada element de la llista està comprès per l'identificador de la playlist i el codi del seu païs.</p>
		<!-- HTML generated using hilite.me --><div style="background: #272822; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #66d9ef">for</span> <span style="color: #f8f8f2">artist</span> <span style="color: #f92672">in</span> <span style="color: #f8f8f2">artists_name:</span>
            <span style="color: #f8f8f2">a</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">artist[</span><span style="color: #e6db74">&quot;name&quot;</span><span style="color: #f8f8f2">]</span>
            <span style="color: #f8f8f2">cantants</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">append(a)</span>
</pre></div>
		<p>És per això que tornem a iterar sobre la llista "artists_name" i afegim en una llista tots els cantants per separats. Fet que farà que més endavant poguem escollir quin d'aquests cantants volem assignar a cada cançó.
</p>
		<!-- HTML generated using hilite.me --><div style="background: #272822; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #66d9ef">for</span> <span style="color: #f8f8f2">element</span> <span style="color: #f92672">in</span> <span style="color: #f8f8f2">features:</span>
            <span style="color: #f8f8f2">dance</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">element[</span><span style="color: #e6db74">&quot;danceability&quot;</span><span style="color: #f8f8f2">]</span>
            <span style="color: #f8f8f2">energy</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">element[</span><span style="color: #e6db74">&quot;energy&quot;</span><span style="color: #f8f8f2">]</span>
            <span style="color: #f8f8f2">key</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">element[</span><span style="color: #e6db74">&quot;key&quot;</span><span style="color: #f8f8f2">]</span>
            <span style="color: #f8f8f2">acousticness</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">element[</span><span style="color: #e6db74">&quot;acousticness&quot;</span><span style="color: #f8f8f2">]</span>
            <span style="color: #f8f8f2">duration_ms</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">element[</span><span style="color: #e6db74">&quot;duration_ms&quot;</span><span style="color: #f8f8f2">]</span>
            <span style="color: #f8f8f2">loudness</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">element[</span><span style="color: #e6db74">&quot;loudness&quot;</span><span style="color: #f8f8f2">]</span>
            <span style="color: #f8f8f2">speechiness</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">element[</span><span style="color: #e6db74">&quot;speechiness&quot;</span><span style="color: #f8f8f2">]</span>
            <span style="color: #f8f8f2">tempo</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">element[</span><span style="color: #e6db74">&quot;tempo&quot;</span><span style="color: #f8f8f2">]</span>
</pre></div>
		<h2>Generar Dataset</h2>
		<p>A continuació iterem sobre la llista de les "audiofeatures" i a cada element d'aquesta llista li assignem la variable corresponent al seu nom. Les audio_features preseleccionades per aquest estudi son: "danceability", "energy", "key", "acousticness", "duration_ms", "loudness", "speechiness" i "tempo". A les quals les assignem a variables homònimes, que farem servir per introduir totes aquestes mesures i les anteriors en un dataframe.</p>
		<!-- HTML generated using hilite.me --><div style="background: #272822; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #f8f8f2">df</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">pd</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">DataFrame({</span>
                <span style="color: #e6db74">&quot;danceability&quot;</span><span style="color: #f8f8f2">:</span> <span style="color: #f8f8f2">[dance],</span>
                <span style="color: #e6db74">&quot;artist_name&quot;</span><span style="color: #f8f8f2">:</span> <span style="color: #f8f8f2">[cantants[</span><span style="color: #ae81ff">0</span><span style="color: #f8f8f2">]],</span>
                <span style="color: #e6db74">&quot;song_id&quot;</span><span style="color: #f8f8f2">:</span> <span style="color: #f8f8f2">[song_id],</span>
                <span style="color: #e6db74">&quot;track_name&quot;</span><span style="color: #f8f8f2">:</span> <span style="color: #f8f8f2">[track_name],</span>
                <span style="color: #e6db74">&quot;key&quot;</span><span style="color: #f8f8f2">:</span> <span style="color: #f8f8f2">[key],</span>
                <span style="color: #e6db74">&quot;energy&quot;</span><span style="color: #f8f8f2">:</span> <span style="color: #f8f8f2">[energy],</span>
                <span style="color: #e6db74">&quot;acousticness&quot;</span><span style="color: #f8f8f2">:</span> <span style="color: #f8f8f2">[acousticness],</span>
                <span style="color: #e6db74">&quot;duration_ms&quot;</span><span style="color: #f8f8f2">:</span> <span style="color: #f8f8f2">[duration_ms],</span>
                <span style="color: #e6db74">&quot;loudness&quot;</span><span style="color: #f8f8f2">:</span> <span style="color: #f8f8f2">[loudness],</span>
                <span style="color: #e6db74">&quot;speechiness&quot;</span><span style="color: #f8f8f2">:</span> <span style="color: #f8f8f2">[speechiness],</span>
                <span style="color: #e6db74">&quot;tempo&quot;</span><span style="color: #f8f8f2">:</span> <span style="color: #f8f8f2">[tempo]</span>
            <span style="color: #f8f8f2">})</span>
</pre></div>
		<p>Finalment creem el daframe fent servir totes les "audio_features" esmentades més el "song_id", "track_name" i el primer artista de la llista d'artistes de la cançó.</p>
		<!-- HTML generated using hilite.me --><div style="background: #272822; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%">		<span style="color: #f8f8f2">llista</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">append(df)</span>
    <span style="color: #f8f8f2">time</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">sleep(</span><span style="color: #ae81ff">0.2</span><span style="color: #f8f8f2">)</span>
</pre></div>
		<p>Un cop tenim el dataframe l'afegim a la llista, on s'aniràn afegint els dataframes de cada cançó a mesura que avançi la iteració. La iteració de "query""items" la tanquem amb un time sleep de 0.2 segons per no saturar la api.
			
Tenim tots els dataframes en una llista, però ara ens fa falta concatenar aquesta llista per aconseguir un dataset utilitzable.</p>
		<!-- HTML generated using hilite.me --><div style="background: #272822; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"> <span style="color: #f8f8f2">dataset</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">pd</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">concat(llista)</span>
    <span style="color: #66d9ef">print</span><span style="color: #f8f8f2">(dataset)</span>
    <span style="color: #f8f8f2">dataset</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">to_csv(f</span><span style="color: #e6db74">&quot;dataset-{pais}-{list}.csv&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">index</span><span style="color: #f92672">=</span><span style="color: #f8f8f2">False)</span>
</pre></div>
		<p>Concatenem aquesta llista en la variable dataset i exportem aquest dataset en un csv de nom igual al json previament generat, amb el nom del païs i el id de la playlist. Això ens dona 35 csvs individuals per cada païs, els quals el seguent pas serà ajuntar tots aquests csvs en un csv global. </p>
		<h2>Merging CSVS</h2>
		<p>Per concatenar tots aquests datasets generats necessitarem un nou mòdul, la biblioteca anomenada "glob". I la ja coneguda "pandas"</p>
		<!-- HTML generated using hilite.me --><div style="background: #272822; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #f92672">import</span> <span style="color: #f8f8f2">glob</span>
<span style="color: #f92672">import</span> <span style="color: #f8f8f2">pandas</span> <span style="color: #f92672">as</span> <span style="color: #f8f8f2">pd</span>
</pre></div>
		<p>És important tenir tots els arxius csv en la mateixa carpeta, ja que mitjançant la nomenclatura podrem accedir a tots aquests arxius sense haver d'anomenar-los individualment.</p>
		<!-- HTML generated using hilite.me --><div style="background: #272822; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #f8f8f2">file_list</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">glob</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">glob(</span><span style="color: #e6db74">&quot;*.csv&quot;</span><span style="color: #f8f8f2">)</span>

<span style="color: #f8f8f2">df_concatenated</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">pd</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">DataFrame()</span>

<span style="color: #66d9ef">for</span> <span style="color: #f8f8f2">file</span> <span style="color: #f92672">in</span> <span style="color: #f8f8f2">file_list:</span>
    <span style="color: #f8f8f2">df</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">pd</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">read_csv(file)</span>
    <span style="color: #f8f8f2">df_concatenated</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">pd</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">concat([df_concatenated,</span> <span style="color: #f8f8f2">df])</span>
</pre></div>
		<p>Fent servir el la funció del glob.glob llegim i emmagatzamem en una llista tots els datasets amb format csv del directori. A continuació creem un Dataframe buit on emmagatzarem els datasets concatenats i iterem sobre cada arxiu de la llista de datasets creada anteriorment.

Bàsicament llegim el csv, l'assignem a una variable i anem concatenant cada arxiu al dataframe buit previament creat. I finalmente creem un nou csv on tenim tot merged.
</p>
		<!-- HTML generated using hilite.me --><div style="background: #272822; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #f8f8f2">df_concatenated</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">to_csv(</span><span style="color: #e6db74">&quot;concatenated_file_totjunt.csv&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">index</span><span style="color: #f92672">=</span><span style="color: #f8f8f2">False)</span>
</pre></div>
		<p>Tot aquest codi es pot consultar en el seguent arxiu python: https://github.com/Aleksandeeeer/ApuntsPython/blob/main/SpotipyFinal/main.py </p>
	<!-- Fi Fragment de codi -->
    <h2>Europa i mundial</h2>
    <p>Tots aquests passos es van realitzar primerament amb uns 20 països europeus, generant un dataset idèntic al dataset concatenat mundial pero amb europa. I aquest procés de merging es va emprar entre aquests dos datasets generals generant un dataset total Europa+Mundial. Per tant podem dir que tenim un dataset Europeu, un dataset fora d'europa i un dataset Mundial. On el dataset mundial comprèn un total de 57 països.</p>
	<h2>Grapho amb Gephi</h2>
	<p>Un cop generat tot això ja esmentat vam decidir generar un dataset especial per poder tractar amb gephi i generar un grapho de relacions entre països i artistes.</p>
	<!-- HTML generated using hilite.me --><div style="background: #272822; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #f92672">import</span> <span style="color: #f8f8f2">pandas</span> <span style="color: #f92672">as</span> <span style="color: #f8f8f2">pd</span>

<span style="color: #f8f8f2">df</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">pd</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">read_csv(</span><span style="color: #e6db74">&quot;concatenated_file_mundial.csv&quot;</span><span style="color: #f8f8f2">)</span>

<span style="color: #f8f8f2">graph</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">[]</span>

<span style="color: #66d9ef">for</span> <span style="color: #f8f8f2">item,</span> <span style="color: #f8f8f2">row</span> <span style="color: #f92672">in</span> <span style="color: #f8f8f2">df</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">iterrows():</span>
    <span style="color: #f8f8f2">source</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">row[</span><span style="color: #e6db74">&quot;artist_name&quot;</span><span style="color: #f8f8f2">]</span>
    <span style="color: #f8f8f2">target</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">row[</span><span style="color: #e6db74">&quot;pais&quot;</span><span style="color: #f8f8f2">]</span>
    <span style="color: #f8f8f2">tupla</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">(source,</span> <span style="color: #f8f8f2">target)</span>
    <span style="color: #f8f8f2">graph</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">append(tupla)</span>
</pre></div>
	<p>Agafem el csv general i el convertim en un dataframe, creem una llista buida per emmagatzemar les tuples resultants i iterem sobre les files del dataframe.

Agafem les dues variables de "artist_name" i "pais" i les assignem a les variables de "source" i "target" respectivament. Seguidament creem una tupla amb aquestes dues variables i les anem afegint a la llista de tuples.</p>
	<!-- HTML generated using hilite.me --><div style="background: #272822; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #f8f8f2">final</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">pd</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">DataFrame(graph,</span> <span style="color: #f8f8f2">columns</span><span style="color: #f92672">=</span> <span style="color: #f8f8f2">[</span><span style="color: #e6db74">&quot;source&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;target&quot;</span><span style="color: #f8f8f2">])</span>
<span style="color: #f8f8f2">final</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">to_csv(</span><span style="color: #e6db74">&quot;grapho_mundial.csv&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">index</span><span style="color: #f92672">=</span> <span style="color: #f8f8f2">False)</span>
</pre></div>
	<p>El pas final serà convertir en un dataset aquesta llista de tuples i exportar-ho en un csv. Igual que hem fet amb els anteriors datasets generem un dataset per Europa, un per fora d'Europa i un mundial.

Tot aquest codi es accessible aqui: https://github.com/Aleksandeeeer/ApuntsPython/blob/main/SpotipyFinal/graphgephi.py
</p>
	<h2>Datasets</h2>
	<p>Tots els datasets son accessibles en el seguent repositori de github: https://github.com/Aleksandeeeer/ApuntsPython/tree/main/SpotipyFinal
</p>
	<!-- Ejemplo de codigo de Grafico incrustado-->
    <div class='tableauPlaceholder' id='viz1681300013018' style='position: relative'><noscript><a href='#'><img alt='Prmedio de streamers por dia ' src='https:&#47;&#47;public.tableau.com&#47;static&#47;images&#47;pr&#47;promstreamersdia&#47;Prmediodestreamerspordia&#47;1_rss.png' style='border: none' /></a></noscript><object class='tableauViz'  style='display:none;'><param name='host_url' value='https%3A%2F%2Fpublic.tableau.com%2F' /> <param name='embed_code_version' value='3' /> <param name='site_root' value='' /><param name='name' value='promstreamersdia&#47;Prmediodestreamerspordia' /><param name='tabs' value='no' /><param name='toolbar' value='yes' /><param name='static_image' value='https:&#47;&#47;public.tableau.com&#47;static&#47;images&#47;pr&#47;promstreamersdia&#47;Prmediodestreamerspordia&#47;1.png' /> <param name='animate_transition' value='yes' /><param name='display_static_image' value='yes' /><param name='display_spinner' value='yes' /><param name='display_overlay' value='yes' /><param name='display_count' value='yes' /><param name='language' value='es-ES' /></object></div>                <script type='text/javascript'>                    var divElement = document.getElementById('viz1681300013018');                    var vizElement = divElement.getElementsByTagName('object')[0];                    vizElement.style.width='100%';vizElement.style.height=(divElement.offsetWidth*0.75)+'px';                    var scriptElement = document.createElement('script');                    scriptElement.src = 'https://public.tableau.com/javascripts/api/viz_v1.js';                    vizElement.parentNode.insertBefore(scriptElement, vizElement);                </script>
    <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
                       
            <footer>
			<hr>
			<p>
               AUTORES
            </p>

			</footer>
		</div>
	</body>
</html>
